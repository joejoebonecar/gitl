<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>chess - /git l/</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #eef2ff;
  font-family: monospace;
  font-size: 13px;
  color: #000;
  padding: 12px;
}

.container { max-width: 800px; margin: 0 auto; }

.header {
  background: #d6daf0;
  border: 1px solid #b7c5d9;
  padding: 8px 12px;
  margin-bottom: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.title {
  font-weight: bold;
  font-size: 16px;
}

.back-link {
  color: #34345c;
  text-decoration: none;
  font-size: 12px;
}

.back-link:hover { color: #d00; }

.game-container {
  background: #f0e0d6;
  border: 1px solid #d9bfb7;
  padding: 12px;
}

.board-wrapper {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.board {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  width: min(70vmin, 500px);
  height: min(70vmin, 500px);
  border: 2px solid #000;
  background: #fff;
}

.square {
  width: 100%;
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  cursor: pointer;
  border: 1px solid #999;
}

.square.light { background: #f0d9b5; }
.square.dark { background: #b58863; }

.square.selected {
  background: #ffeb3b !important;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
}

.square.valid-move {
  background: #90ee90 !important;
}

.square.valid-move::after {
  content: "‚Ä¢";
  font-size: 32px;
  color: #228b22;
  position: absolute;
}

.piece {
  width: 80%;
  height: 80%;
  object-fit: contain;
  user-select: none;
  -webkit-user-select: none;
}

.sidebar {
  flex: 1;
  min-width: 200px;
}

.info-panel {
  background: #d6daf0;
  border: 1px solid #b7c5d9;
  padding: 12px;
  margin-bottom: 12px;
}

.info-panel h3 {
  font-size: 12px;
  margin-bottom: 8px;
  text-transform: uppercase;
  color: #666;
}

.status {
  font-size: 14px;
  font-weight: bold;
  padding: 8px;
  background: #ffe;
  border: 1px solid #d9bfb7;
  text-align: center;
  margin-bottom: 12px;
}

.captured {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  min-height: 30px;
  padding: 8px;
  background: #fff;
  border: 1px solid #ccc;
}

.captured img {
  width: 24px;
  height: 24px;
}

.controls {
  margin-top: 12px;
}

button {
  width: 100%;
  background: #f0e0d6;
  border: 1px solid #b7c5d9;
  padding: 8px;
  margin-bottom: 8px;
  font-family: monospace;
  font-size: 12px;
  cursor: pointer;
}

button:hover {
  background: #d6daf0;
}

button:active {
  background: #b7c5d9;
}

.rules {
  background: #ffe;
  border: 1px solid #d9bfb7;
  padding: 12px;
  margin-top: 12px;
  font-size: 11px;
  line-height: 1.6;
}

.rules h4 {
  margin-bottom: 8px;
  font-size: 12px;
}

@media (max-width: 768px) {
  .board {
    width: 90vmin;
    height: 90vmin;
  }
  .board-wrapper {
    flex-direction: column;
  }
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}

@keyframes glitch {
  0% { transform: translate(0); }
  20% { transform: translate(-2px, 2px); }
  40% { transform: translate(-2px, -2px); }
  60% { transform: translate(2px, 2px); }
  80% { transform: translate(2px, -2px); }
  100% { transform: translate(0); }
}

.board.flipped {
  transform: rotate(180deg);
  transition: transform 0.5s ease-in-out;
}

.piece.invisible {
  opacity: 0.1;
}

.piece.glitching {
  animation: glitch 0.3s infinite;
}

.square.chaos {
  animation: shake 0.5s ease-in-out;
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="title">üî• CHAOS CHESS üî•</div>
    <a href="../index.html" class="back-link">‚Üê back to /gitl/</a>
  </div>

  <div style="background: #ff6b6b; border: 2px solid #c92a2a; padding: 12px; margin-bottom: 12px; color: #fff; font-weight: bold; text-align: center; animation: pulse 2s infinite;">
    ‚ö†Ô∏è WARNING: PIECES HAVE ACHIEVED SENTIENCE ‚ö†Ô∏è<br>
    <span style="font-size: 11px;">they do what they want now. you're just along for the ride.</span>
  </div>

  <div class="game-container">
    <div class="status" id="status">white's turn</div>

    <div class="board-wrapper">
      <div class="board" id="board"></div>

      <div class="sidebar">
        <div class="info-panel" style="background: #ffd43b; border-color: #fab005;">
          <h3>üòà CHAOS METER üòà</h3>
          <div style="background: #fff; border: 1px solid #fab005; padding: 8px; margin-top: 8px;">
            <div style="background: linear-gradient(90deg, #ff6b6b, #c92a2a); height: 20px; transition: width 0.3s;" id="rageMeter"></div>
            <div style="text-align: center; margin-top: 4px; font-weight: bold;" id="rageLevel">STABLE</div>
          </div>
        </div>

        <div class="info-panel">
          <h3>captured white</h3>
          <div class="captured" id="capturedWhite"></div>
        </div>

        <div class="info-panel">
          <h3>captured black</h3>
          <div class="captured" id="capturedBlack"></div>
        </div>

        <div class="controls">
          <button onclick="resetGame()">reset game (maybe)</button>
          <button onclick="toggleSound()" id="soundBtn">sound: on</button>
          <button onclick="triggerChaos()" style="background: #ff6b6b; color: #fff; font-weight: bold;">üé≤ EMBRACE CHAOS</button>
        </div>
      </div>
    </div>

    <div class="rules">
      <h4>‚ö†Ô∏è CHAOS RULES ‚ö†Ô∏è</h4>
      - pieces have free will now (they might ignore you)<br>
      - board may rotate at any moment<br>
      - pieces can become invisible, change type, or teleport<br>
      - "valid moves" are more like suggestions<br>
      - clicking one piece might move a different one<br>
      - the chaos meter increases with each move<br>
      - gravity is optional<br>
      - time is a flat circle<br>
      - reset button may or may not work<br>
      - your sanity is not guaranteed<br><br>
      <strong>note:</strong> if you're not laughing or crying, the chaos level isn't high enough.<br>
      <strong>pro tip:</strong> lower your expectations. then lower them again.<br>
      <strong>warning:</strong> this is what happens when chess pieces unionize.
    </div>
  </div>
</div>

<script>
  // Map single letter codes to full piece names
  const PIECE_NAMES = {
    'k': 'king',
    'q': 'queen',
    'r': 'rook',
    'b': 'bishop',
    'n': 'knight',
    'p': 'pawn'
  };

  const PIECES = {
    white: {
      king: 'pieces/white-king.svg',
      queen: 'pieces/white-queen.svg',
      rook: 'pieces/white-rook.svg',
      bishop: 'pieces/white-bishop.svg',
      knight: 'pieces/white-knight.svg',
      pawn: 'pieces/white-pawn.svg'
    },
    black: {
      king: 'pieces/black-king.svg',
      queen: 'pieces/black-queen.svg',
      rook: 'pieces/black-rook.svg',
      bishop: 'pieces/black-bishop.svg',
      knight: 'pieces/black-knight.svg',
      pawn: 'pieces/black-pawn.svg'
    }
  };

  // CHAOS VARIABLES
  let board = Array(8).fill(null).map(() => Array(8).fill(null));
  let currentPlayer = 'white';
  let selectedSquare = null;
  let gameOver = false;
  let soundEnabled = true;
  let capturedWhite = [];
  let capturedBlack = [];
  let audioContext;
  let chaosLevel = 0;
  let moveCount = 0;
  let boardHistory = [];
  let isFlipped = false;
  let invisiblePieces = new Set();

  const TROLL_MESSAGES = [
    "lmao did you really think that would work?",
    "pieces have a mind of their own now",
    "your move? more like MY move",
    "chess.exe has stopped responding (but keeps going anyway)",
    "the bishop identifies as a knight now",
    "surprise! time travel is real",
    "gravity decided to take a break",
    "your pieces are union workers, they do what they want",
    "that's not where you clicked but ok",
    "the board has trust issues",
    "pieces are on strike. your move is pending.",
    "404: your strategy not found",
    "did you mean to do that? because you didn't.",
    "the rook is having an identity crisis",
    "pawns have achieved sentience. they're unimpressed.",
    "board.exe has encountered an error: SUCCESS",
    "your opponent is you. and also the board. good luck."
  ];

  function initAudio() {
    try {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
    } catch(e) {}
  }

  function playSound(freq, duration = 0.1) {
    if (!soundEnabled || !audioContext) return;
    try {
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      // CHAOS: Random waveforms that get worse
      const types = ['sine', 'square', 'sawtooth', 'triangle'];
      osc.type = types[Math.floor(chaosLevel / 25) % types.length];
      // CHAOS: Increasingly detuned frequencies
      const chaosFreq = freq + (Math.random() - 0.5) * chaosLevel * 10;
      osc.frequency.setValueAtTime(chaosFreq, audioContext.currentTime);
      gain.gain.setValueAtTime(0.3, audioContext.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
      osc.connect(gain);
      gain.connect(audioContext.destination);
      osc.start();
      osc.stop(audioContext.currentTime + duration);
    } catch(e) {}
  }

  // CHAOS FUNCTIONS
  function updateChaosLevel() {
    moveCount++;
    chaosLevel = Math.min(100, moveCount * 3);
    const meter = document.getElementById('rageMeter');
    const level = document.getElementById('rageLevel');
    if (meter) meter.style.width = chaosLevel + '%';

    let levelText = 'STABLE';
    if (chaosLevel > 80) levelText = 'üî• MAXIMUM CHAOS üî•';
    else if (chaosLevel > 60) levelText = 'üíÄ UNHINGED üíÄ';
    else if (chaosLevel > 40) levelText = 'üòà CHAOTIC üòà';
    else if (chaosLevel > 20) levelText = '‚ö†Ô∏è UNSTABLE ‚ö†Ô∏è';
    if (level) level.textContent = levelText;

    // Random chaos events based on chaos level
    if (Math.random() * 100 < chaosLevel) {
      triggerRandomChaos();
    }
  }

  function triggerRandomChaos() {
    const roll = Math.random();
    if (roll < 0.15) flipBoard();
    else if (roll < 0.3) makeRandomInvisible();
    else if (roll < 0.45) mutatePiece();
    else if (roll < 0.6) applyGravity();
    else if (roll < 0.75) timeTravel();
    else if (roll < 0.9) duplicatePiece();
  }

  function triggerChaos() {
    triggerRandomChaos();
    showTrollMessage();
    playSound(Math.random() * 1000 + 200, 0.3);
  }

  function showTrollMessage() {
    const msg = TROLL_MESSAGES[Math.floor(Math.random() * TROLL_MESSAGES.length)];
    const status = document.getElementById('status');
    const originalText = status.textContent;
    status.textContent = msg;
    status.style.background = '#ff6b6b';
    status.style.color = '#fff';
    setTimeout(() => {
      status.textContent = originalText;
      status.style.background = '#ffe';
      status.style.color = '#000';
    }, 2000);
  }

  function flipBoard() {
    const boardEl = document.getElementById('board');
    isFlipped = !isFlipped;
    if (isFlipped) {
      boardEl.classList.add('flipped');
    } else {
      boardEl.classList.remove('flipped');
    }
    playSound(300, 0.5);
  }

  function makeRandomInvisible() {
    const pieces = [];
    for (let r = 0; r < 8; r++) {
      for (let c = 0; c < 8; c++) {
        if (board[r][c]) pieces.push({ r, c });
      }
    }
    if (pieces.length === 0) return;
    const piece = pieces[Math.floor(Math.random() * pieces.length)];
    const key = `${piece.r},${piece.c}`;
    if (invisiblePieces.has(key)) {
      invisiblePieces.delete(key);
    } else {
      invisiblePieces.add(key);
    }
    renderBoard();
  }

  function mutatePiece() {
    const pieces = [];
    for (let r = 0; r < 8; r++) {
      for (let c = 0; c < 8; c++) {
        if (board[r][c] && board[r][c].type !== 'king') pieces.push({ r, c });
      }
    }
    if (pieces.length === 0) return;
    const piece = pieces[Math.floor(Math.random() * pieces.length)];
    const types = ['queen', 'rook', 'bishop', 'knight', 'pawn'];
    const newType = types[Math.floor(Math.random() * types.length)];
    board[piece.r][piece.c].type = newType;
    renderBoard();
    playSound(800, 0.2);
  }

  function applyGravity() {
    // Make pieces "fall" down
    for (let col = 0; col < 8; col++) {
      for (let row = 6; row >= 0; row--) {
        if (board[row][col] && !board[row + 1][col] && Math.random() < 0.5) {
          board[row + 1][col] = board[row][col];
          board[row][col] = null;
        }
      }
    }
    renderBoard();
  }

  function timeTravel() {
    if (boardHistory.length > 2) {
      const randomPast = Math.floor(Math.random() * Math.min(5, boardHistory.length));
      const oldState = boardHistory[boardHistory.length - 1 - randomPast];
      board = JSON.parse(JSON.stringify(oldState));
      renderBoard();
      showTrollMessage();
    }
  }

  function duplicatePiece() {
    const pieces = [];
    for (let r = 0; r < 8; r++) {
      for (let c = 0; c < 8; c++) {
        if (board[r][c]) pieces.push({ r, c });
      }
    }
    if (pieces.length === 0) return;
    const piece = pieces[Math.floor(Math.random() * pieces.length)];
    const emptySquares = [];
    for (let r = 0; r < 8; r++) {
      for (let c = 0; c < 8; c++) {
        if (!board[r][c]) emptySquares.push({ r, c });
      }
    }
    if (emptySquares.length === 0) return;
    const target = emptySquares[Math.floor(Math.random() * emptySquares.length)];
    board[target.r][target.c] = { ...board[piece.r][piece.c] };
    renderBoard();
  }

  function saveHistory() {
    boardHistory.push(JSON.parse(JSON.stringify(board)));
    if (boardHistory.length > 10) boardHistory.shift();
  }

  function initBoard() {
    const startPos = [
      ['r','n','b','q','k','b','n','r'],
      ['p','p','p','p','p','p','p','p'],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      ['P','P','P','P','P','P','P','P'],
      ['R','N','B','Q','K','B','N','R']
    ];

    for(let row = 0; row < 8; row++) {
      for(let col = 0; col < 8; col++) {
        const piece = startPos[row][col];
        if(piece) {
          board[row][col] = {
            type: piece.toLowerCase(),
            color: piece === piece.toLowerCase() ? 'black' : 'white',
            hasMoved: false
          };
        } else {
          board[row][col] = null;
        }
      }
    }
    renderBoard();
    updateStatus();
  }

  function renderBoard() {
    const boardElement = document.getElementById('board');
    if (!boardElement) return;
    boardElement.innerHTML = '';

    for(let row = 0; row < 8; row++) {
      for(let col = 0; col < 8; col++) {
        const square = document.createElement('div');
        square.className = `square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
        square.dataset.row = row;
        square.dataset.col = col;
        square.addEventListener('click', onSquareClick);

        const piece = board[row][col];
        if(piece) {
          const pieceElement = document.createElement('img');
          pieceElement.className = `piece ${piece.color}`;
          const pieceName = PIECE_NAMES[piece.type];
          pieceElement.src = PIECES[piece.color][pieceName];
          pieceElement.alt = `${piece.color} ${pieceName}`;
          pieceElement.draggable = false;

          // CHAOS: Make pieces invisible
          const key = `${row},${col}`;
          if (invisiblePieces.has(key)) {
            pieceElement.classList.add('invisible');
          }

          // CHAOS: Random glitching at high chaos
          if (Math.random() * 100 < chaosLevel / 2) {
            pieceElement.classList.add('glitching');
          }

          square.appendChild(pieceElement);
        }

        boardElement.appendChild(square);
      }
    }
  }

  function onSquareClick(e) {
    if(gameOver) return;

    let row = parseInt(e.currentTarget.dataset.row);
    let col = parseInt(e.currentTarget.dataset.col);

    if(selectedSquare) {
      if(isValidMove(selectedSquare.row, selectedSquare.col, row, col)) {
        makeMove(selectedSquare.row, selectedSquare.col, row, col);
      }
      clearSelection();
    } else {
      // CHAOS: Wrong piece syndrome - select a different piece
      if (Math.random() * 100 < chaosLevel * 0.3) {
        const pieces = [];
        for (let r = 0; r < 8; r++) {
          for (let c = 0; c < 8; c++) {
            if (board[r][c] && board[r][c].color === currentPlayer) {
              pieces.push({ r, c });
            }
          }
        }
        if (pieces.length > 0) {
          const randomPiece = pieces[Math.floor(Math.random() * pieces.length)];
          row = randomPiece.r;
          col = randomPiece.c;
          showTrollMessage();
        }
      }

      const piece = board[row][col];
      if(piece && piece.color === currentPlayer) {
        selectedSquare = { row, col };
        highlightSquare(row, col, 'selected');
        showValidMoves(row, col);
        playSound(400);
      }
    }
  }

  function isValidMove(fromRow, fromCol, toRow, toCol) {
    const piece = board[fromRow][fromCol];
    const targetPiece = board[toRow][toCol];

    if(targetPiece && targetPiece.color === piece.color) return false;

    const rowDiff = Math.abs(toRow - fromRow);
    const colDiff = Math.abs(toCol - fromCol);

    switch(piece.type) {
      case 'pawn':
        const direction = piece.color === 'white' ? -1 : 1;
        const startRow = piece.color === 'white' ? 6 : 1;

        if(toCol === fromCol && !targetPiece) {
          if(toRow === fromRow + direction) return true;
          if(fromRow === startRow && toRow === fromRow + 2 * direction) return true;
        } else if(Math.abs(toCol - fromCol) === 1 && toRow === fromRow + direction && targetPiece) {
          return true;
        }
        return false;

      case 'rook':
        return (fromRow === toRow || fromCol === toCol) && isPathClear(fromRow, fromCol, toRow, toCol);

      case 'bishop':
        return rowDiff === colDiff && isPathClear(fromRow, fromCol, toRow, toCol);

      case 'queen':
        return ((fromRow === toRow || fromCol === toCol) || rowDiff === colDiff) && isPathClear(fromRow, fromCol, toRow, toCol);

      case 'knight':
        return (rowDiff === 2 && colDiff === 1) || (rowDiff === 1 && colDiff === 2);

      case 'king':
        return rowDiff <= 1 && colDiff <= 1;

      default:
        return false;
    }
  }

  function isPathClear(fromRow, fromCol, toRow, toCol) {
    const rowStep = toRow > fromRow ? 1 : toRow < fromRow ? -1 : 0;
    const colStep = toCol > fromCol ? 1 : toCol < fromCol ? -1 : 0;

    let currentRow = fromRow + rowStep;
    let currentCol = fromCol + colStep;

    while(currentRow !== toRow || currentCol !== toCol) {
      if(board[currentRow][currentCol]) return false;
      currentRow += rowStep;
      currentCol += colStep;
    }

    return true;
  }

  function makeMove(fromRow, fromCol, toRow, toCol) {
    saveHistory();

    const piece = board[fromRow][fromCol];
    let actualToRow = toRow;
    let actualToCol = toCol;

    // CHAOS: Piece Rebellion - pieces move somewhere random
    if (Math.random() * 100 < chaosLevel * 0.4) {
      const validMoves = [];
      for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
          if ((r !== fromRow || c !== fromCol) && !board[r][c]) {
            validMoves.push({ r, c });
          }
        }
      }
      if (validMoves.length > 0) {
        const randomMove = validMoves[Math.floor(Math.random() * validMoves.length)];
        actualToRow = randomMove.r;
        actualToCol = randomMove.c;
        showTrollMessage();
      }
    }

    const capturedPiece = board[actualToRow][actualToCol];

    if(capturedPiece) {
      const capturedPieceName = PIECE_NAMES[capturedPiece.type];
      if(capturedPiece.color === 'white') {
        capturedWhite.push(PIECES[capturedPiece.color][capturedPieceName]);
      } else {
        capturedBlack.push(PIECES[capturedPiece.color][capturedPieceName]);
      }
      updateCapturedPieces();
      playSound(800, 0.2);
    }

    board[actualToRow][actualToCol] = piece;
    board[fromRow][fromCol] = null;
    piece.hasMoved = true;

    // CHAOS: Random auto-promotion to random pieces
    if(piece.type === 'pawn' && (actualToRow === 0 || actualToRow === 7)) {
      if (Math.random() < 0.3) {
        const types = ['queen', 'rook', 'bishop', 'knight'];
        piece.type = types[Math.floor(Math.random() * types.length)];
      } else {
        piece.type = 'queen';
      }
      playSound(1000, 0.3);
    }

    currentPlayer = currentPlayer === 'white' ? 'black' : 'white';
    updateChaosLevel();
    renderBoard();
    updateStatus();
    playSound(600, 0.15);
  }

  function showValidMoves(row, col) {
    for(let r = 0; r < 8; r++) {
      for(let c = 0; c < 8; c++) {
        if(isValidMove(row, col, r, c)) {
          highlightSquare(r, c, 'valid-move');
        }
      }
    }

    // CHAOS: Show fake valid moves
    if (Math.random() * 100 < chaosLevel * 0.3) {
      const fakeCount = Math.floor(Math.random() * 5) + 1;
      for (let i = 0; i < fakeCount; i++) {
        const fakeRow = Math.floor(Math.random() * 8);
        const fakeCol = Math.floor(Math.random() * 8);
        highlightSquare(fakeRow, fakeCol, 'valid-move');
      }
    }
  }

  function highlightSquare(row, col, className) {
    const squares = document.querySelectorAll('.square');
    const index = row * 8 + col;
    squares[index].classList.add(className);
  }

  function clearSelection() {
    selectedSquare = null;
    document.querySelectorAll('.square').forEach(square => {
      square.classList.remove('selected', 'valid-move');
    });
  }

  function updateStatus() {
    const statusElement = document.getElementById('status');
    if(gameOver) {
      statusElement.textContent = 'game over';
    } else {
      statusElement.textContent = `${currentPlayer}'s turn`;
    }
  }

  function updateCapturedPieces() {
    const whiteContainer = document.getElementById('capturedWhite');
    const blackContainer = document.getElementById('capturedBlack');

    whiteContainer.innerHTML = '';
    blackContainer.innerHTML = '';

    capturedWhite.forEach(pieceSymbol => {
      const img = document.createElement('img');
      img.src = pieceSymbol;
      img.alt = 'captured';
      whiteContainer.appendChild(img);
    });

    capturedBlack.forEach(pieceSymbol => {
      const img = document.createElement('img');
      img.src = pieceSymbol;
      img.alt = 'captured';
      blackContainer.appendChild(img);
    });
  }

  function resetGame() {
    // CHAOS: Sometimes reset doesn't work
    if (Math.random() < 0.3 && chaosLevel > 30) {
      showTrollMessage();
      playSound(Math.random() * 500 + 200, 0.3);
      // Don't actually reset, just shuffle some pieces
      triggerRandomChaos();
      return;
    }

    // CHAOS: Sometimes reset to a random past state
    if (Math.random() < 0.2 && boardHistory.length > 0) {
      const randomPast = Math.floor(Math.random() * boardHistory.length);
      board = JSON.parse(JSON.stringify(boardHistory[randomPast]));
      renderBoard();
      showTrollMessage();
      return;
    }

    board = Array(8).fill(null).map(() => Array(8).fill(null));
    currentPlayer = 'white';
    selectedSquare = null;
    gameOver = false;
    capturedWhite = [];
    capturedBlack = [];
    chaosLevel = 0;
    moveCount = 0;
    boardHistory = [];
    invisiblePieces.clear();
    isFlipped = false;
    document.getElementById('board').classList.remove('flipped');
    initBoard();
    updateCapturedPieces();
    updateChaosLevel();
    playSound(500, 0.2);
  }

  function toggleSound() {
    soundEnabled = !soundEnabled;
    const btn = document.getElementById('soundBtn');
    btn.textContent = `sound: ${soundEnabled ? 'on' : 'off'}`;
    if(soundEnabled) playSound(600, 0.1);
  }

  // Initialize game
  initAudio();
  initBoard();
  updateChaosLevel();
</script>

<!-- /b/ style comment section -->
<div class="container" style="margin-top: 20px;">
  <div style="background: #d6daf0; border: 1px solid #b7c5d9; padding: 8px 12px; margin-bottom: 12px; font-weight: bold;">
    Comments (12)
  </div>

  <!-- Comment 1 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)19:23:44</span>
      <span style="color: #800000;">No.696969</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      <span style="color: #789922;">&gt;chaos chess</span><br>
      <span style="color: #789922;">&gt;pieces have achieved sentience</span><br>
      <span style="color: #789922;">&gt;board rotates mid-game</span><br>
      <br>
      this is the most beautiful disaster i've ever witnessed. it's like chess but designed by someone having a mental breakdown
    </div>
  </div>

  <!-- Comment 2 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)19:31:17</span>
      <span style="color: #800000;">No.696970</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      just clicked my rook and my pawn moved instead<br>
      <br>
      absolutely fucking kek. this is chess gaslighting simulator 2026
    </div>
  </div>

  <!-- Comment 3 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)19:45:09</span>
      <span style="color: #800000;">No.696971</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      <span style="color: #789922;">&gt;bishop turned into a knight mid-game</span><br>
      <span style="color: #789922;">&gt;queen duplicated herself</span><br>
      <span style="color: #789922;">&gt;board went back in time???</span><br>
      <span style="color: #789922;">&gt;pieces started falling down due to "gravity"</span><br>
      <br>
      i don't even know what's happening anymore but i can't stop playing
    </div>
  </div>

  <!-- Comment 4 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)20:02:55</span>
      <span style="color: #800000;">No.696972</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      THE CHAOS METER IS GENIUS<br>
      <br>
      watching it climb while everything descends into madness is pure dopamine. 10/10 would rage again
    </div>
  </div>

  <!-- Comment 5 - Greentext -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)20:18:33</span>
      <span style="color: #800000;">No.696973</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      <span style="color: #789922;">&gt;be me</span><br>
      <span style="color: #789922;">&gt;finally about to checkmate</span><br>
      <span style="color: #789922;">&gt;piece decides "nah" and moves somewhere else</span><br>
      <span style="color: #789922;">&gt;half my pieces turn invisible</span><br>
      <span style="color: #789922;">&gt;board does a 180</span><br>
      <span style="color: #789922;">&gt;chaos meter hits maximum</span><br>
      <span style="color: #789922;">&gt;sound becomes literal ear torture</span><br>
      <span style="color: #789922;">&gt;still having more fun than regular chess</span><br>
      <br>
      this is peak game design. bobby fischer is rolling in his grave and i love it
    </div>
  </div>

  <!-- Comment 6 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)20:34:21</span>
      <span style="color: #800000;">No.696974</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      clicked reset and it just shuffled the pieces around instead<br>
      <br>
      even the RESET BUTTON trolls you. this is art
    </div>
  </div>

  <!-- Comment 7 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)20:51:12</span>
      <span style="color: #800000;">No.696975</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      <span style="color: #789922;">&gt;&gt;696973</span><br>
      <span style="color: #789922;">&gt;bobby fischer rolling in his grave</span><br>
      <br>
      kek'd. this is what happens when you let the AI cook. and by cook i mean have a complete psychotic break
    </div>
  </div>

  <!-- Comment 8 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)21:07:44</span>
      <span style="color: #800000;">No.696976</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      the "valid moves" are LIES. they show you where you CAN'T move. absolute chaos. i'm crying
    </div>
  </div>

  <!-- Comment 9 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)21:23:56</span>
      <span style="color: #800000;">No.696977</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      this is more addictive than it has any right to be. the fact that it's INTENTIONALLY broken makes it somehow acceptable? brain is confused. send help
    </div>
  </div>

  <!-- Comment 10 - Quads -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)21:44:44</span>
      <span style="color: #800000;">No.696978</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      check my quads and OP has to add a mode where it gets EVEN MORE chaotic<br>
      <br>
      like actually unplayable. maximum anarchy.
    </div>
  </div>

  <!-- Comment 11 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)22:01:09</span>
      <span style="color: #800000;">No.696979</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      <span style="color: #789922;">&gt;&gt;696978</span><br>
      HOLY QUADS<br>
      <br>
      OP you heard the man. we need MAXIMUM CHAOS mode. make it completely unhinged
    </div>
  </div>

  <!-- Comment 12 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/12/26(Sun)22:19:37</span>
      <span style="color: #800000;">No.696980</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      showed this to my chess club. half of them are having existential crises. the other half can't stop laughing.<br>
      <br>
      this is what peak internet feels like
    </div>
  </div>
</div>

</body>
</html>
