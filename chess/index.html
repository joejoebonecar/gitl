<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>chess - /git l/</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #eef2ff;
  font-family: monospace;
  font-size: 13px;
  color: #000;
  padding: 12px;
}

.container { max-width: 800px; margin: 0 auto; }

.header {
  background: #d6daf0;
  border: 1px solid #b7c5d9;
  padding: 8px 12px;
  margin-bottom: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.title {
  font-weight: bold;
  font-size: 16px;
}

.back-link {
  color: #34345c;
  text-decoration: none;
  font-size: 12px;
}

.back-link:hover { color: #d00; }

.game-container {
  background: #f0e0d6;
  border: 1px solid #d9bfb7;
  padding: 12px;
}

.board-wrapper {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.board {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  width: min(70vmin, 500px);
  height: min(70vmin, 500px);
  border: 2px solid #000;
  background: #fff;
}

.square {
  width: 100%;
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  cursor: pointer;
  border: 1px solid #999;
}

.square.light { background: #f0d9b5; }
.square.dark { background: #b58863; }

.square.selected {
  background: #ffeb3b !important;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
}

.square.valid-move {
  background: #90ee90 !important;
}

.square.valid-move::after {
  content: "•";
  font-size: 32px;
  color: #228b22;
  position: absolute;
}

.piece {
  width: 80%;
  height: 80%;
  object-fit: contain;
  user-select: none;
  -webkit-user-select: none;
}

.sidebar {
  flex: 1;
  min-width: 200px;
}

.info-panel {
  background: #d6daf0;
  border: 1px solid #b7c5d9;
  padding: 12px;
  margin-bottom: 12px;
}

.info-panel h3 {
  font-size: 12px;
  margin-bottom: 8px;
  text-transform: uppercase;
  color: #666;
}

.status {
  font-size: 14px;
  font-weight: bold;
  padding: 8px;
  background: #ffe;
  border: 1px solid #d9bfb7;
  text-align: center;
  margin-bottom: 12px;
}

.captured {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  min-height: 30px;
  padding: 8px;
  background: #fff;
  border: 1px solid #ccc;
}

.captured img {
  width: 24px;
  height: 24px;
}

.controls {
  margin-top: 12px;
}

button {
  width: 100%;
  background: #f0e0d6;
  border: 1px solid #b7c5d9;
  padding: 8px;
  margin-bottom: 8px;
  font-family: monospace;
  font-size: 12px;
  cursor: pointer;
}

button:hover {
  background: #d6daf0;
}

button:active {
  background: #b7c5d9;
}

.rules {
  background: #ffe;
  border: 1px solid #d9bfb7;
  padding: 12px;
  margin-top: 12px;
  font-size: 11px;
  line-height: 1.6;
}

.rules h4 {
  margin-bottom: 8px;
  font-size: 12px;
}

@media (max-width: 768px) {
  .board {
    width: 90vmin;
    height: 90vmin;
  }
  .board-wrapper {
    flex-direction: column;
  }
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="title">chess.exe</div>
    <a href="../index.html" class="back-link">← back to /gitl/</a>
  </div>

  <div class="game-container">
    <div class="status" id="status">white's turn</div>

    <div class="board-wrapper">
      <div class="board" id="board"></div>

      <div class="sidebar">
        <div class="info-panel">
          <h3>captured white</h3>
          <div class="captured" id="capturedWhite"></div>
        </div>

        <div class="info-panel">
          <h3>captured black</h3>
          <div class="captured" id="capturedBlack"></div>
        </div>

        <div class="controls">
          <button onclick="resetGame()">reset game</button>
          <button onclick="toggleSound()" id="soundBtn">sound: on</button>
        </div>
      </div>
    </div>

    <div class="rules">
      <h4>how to play:</h4>
      - click piece to select<br>
      - click highlighted square to <s>move</s> (to see my failure)<br>
      - RageQuit.chess Pieces are too Chad to listen. And WTF is that sound even?<br>
      - cuz don't fucking remember how to even do it who am I <a href="https://www.chess.com/players/magnus-carlsen" style="color: #34345c;" target="_blank">the super chess master guy</a><br>
      - no castling (not implemented)<br>
      - pawns auto-promote to queen<br><br>
      <strong>note:</strong> two player only. AI coming eventually.
    </div>
  </div>
</div>

<script>
  // Map single letter codes to full piece names
  const PIECE_NAMES = {
    'k': 'king',
    'q': 'queen',
    'r': 'rook',
    'b': 'bishop',
    'n': 'knight',
    'p': 'pawn'
  };

  const PIECES = {
    white: {
      king: 'pieces/white-king.svg',
      queen: 'pieces/white-queen.svg',
      rook: 'pieces/white-rook.svg',
      bishop: 'pieces/white-bishop.svg',
      knight: 'pieces/white-knight.svg',
      pawn: 'pieces/white-pawn.svg'
    },
    black: {
      king: 'pieces/black-king.svg',
      queen: 'pieces/black-queen.svg',
      rook: 'pieces/black-rook.svg',
      bishop: 'pieces/black-bishop.svg',
      knight: 'pieces/black-knight.svg',
      pawn: 'pieces/black-pawn.svg'
    }
  };

  let board = Array(8).fill(null).map(() => Array(8).fill(null));
  let currentPlayer = 'white';
  let selectedSquare = null;
  let gameOver = false;
  let soundEnabled = true;
  let capturedWhite = [];
  let capturedBlack = [];
  let audioContext;

  function initAudio() {
    try {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
    } catch(e) {}
  }

  function playSound(freq, duration = 0.1) {
    if (!soundEnabled || !audioContext) return;
    try {
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(freq, audioContext.currentTime);
      gain.gain.setValueAtTime(0.3, audioContext.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
      osc.connect(gain);
      gain.connect(audioContext.destination);
      osc.start();
      osc.stop(audioContext.currentTime + duration);
    } catch(e) {}
  }

  function initBoard() {
    const startPos = [
      ['r','n','b','q','k','b','n','r'],
      ['p','p','p','p','p','p','p','p'],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      [null,null,null,null,null,null,null,null],
      ['P','P','P','P','P','P','P','P'],
      ['R','N','B','Q','K','B','N','R']
    ];

    for(let row = 0; row < 8; row++) {
      for(let col = 0; col < 8; col++) {
        const piece = startPos[row][col];
        if(piece) {
          board[row][col] = {
            type: piece.toLowerCase(),
            color: piece === piece.toLowerCase() ? 'black' : 'white',
            hasMoved: false
          };
        } else {
          board[row][col] = null;
        }
      }
    }
    renderBoard();
    updateStatus();
  }

  function renderBoard() {
    const boardElement = document.getElementById('board');
    if (!boardElement) return;
    boardElement.innerHTML = '';

    for(let row = 0; row < 8; row++) {
      for(let col = 0; col < 8; col++) {
        const square = document.createElement('div');
        square.className = `square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
        square.dataset.row = row;
        square.dataset.col = col;
        square.addEventListener('click', onSquareClick);

        const piece = board[row][col];
        if(piece) {
          const pieceElement = document.createElement('img');
          pieceElement.className = `piece ${piece.color}`;
          const pieceName = PIECE_NAMES[piece.type];
          pieceElement.src = PIECES[piece.color][pieceName];
          pieceElement.alt = `${piece.color} ${pieceName}`;
          pieceElement.draggable = false;
          square.appendChild(pieceElement);
        }

        boardElement.appendChild(square);
      }
    }
  }

  function onSquareClick(e) {
    if(gameOver) return;

    const row = parseInt(e.currentTarget.dataset.row);
    const col = parseInt(e.currentTarget.dataset.col);

    if(selectedSquare) {
      if(isValidMove(selectedSquare.row, selectedSquare.col, row, col)) {
        makeMove(selectedSquare.row, selectedSquare.col, row, col);
      }
      clearSelection();
    } else {
      const piece = board[row][col];
      if(piece && piece.color === currentPlayer) {
        selectedSquare = { row, col };
        highlightSquare(row, col, 'selected');
        showValidMoves(row, col);
        playSound(400);
      }
    }
  }

  function isValidMove(fromRow, fromCol, toRow, toCol) {
    const piece = board[fromRow][fromCol];
    const targetPiece = board[toRow][toCol];

    if(targetPiece && targetPiece.color === piece.color) return false;

    const rowDiff = Math.abs(toRow - fromRow);
    const colDiff = Math.abs(toCol - fromCol);

    switch(piece.type) {
      case 'pawn':
        const direction = piece.color === 'white' ? -1 : 1;
        const startRow = piece.color === 'white' ? 6 : 1;

        if(toCol === fromCol && !targetPiece) {
          if(toRow === fromRow + direction) return true;
          if(fromRow === startRow && toRow === fromRow + 2 * direction) return true;
        } else if(Math.abs(toCol - fromCol) === 1 && toRow === fromRow + direction && targetPiece) {
          return true;
        }
        return false;

      case 'rook':
        return (fromRow === toRow || fromCol === toCol) && isPathClear(fromRow, fromCol, toRow, toCol);

      case 'bishop':
        return rowDiff === colDiff && isPathClear(fromRow, fromCol, toRow, toCol);

      case 'queen':
        return ((fromRow === toRow || fromCol === toCol) || rowDiff === colDiff) && isPathClear(fromRow, fromCol, toRow, toCol);

      case 'knight':
        return (rowDiff === 2 && colDiff === 1) || (rowDiff === 1 && colDiff === 2);

      case 'king':
        return rowDiff <= 1 && colDiff <= 1;

      default:
        return false;
    }
  }

  function isPathClear(fromRow, fromCol, toRow, toCol) {
    const rowStep = toRow > fromRow ? 1 : toRow < fromRow ? -1 : 0;
    const colStep = toCol > fromCol ? 1 : toCol < fromCol ? -1 : 0;

    let currentRow = fromRow + rowStep;
    let currentCol = fromCol + colStep;

    while(currentRow !== toRow || currentCol !== toCol) {
      if(board[currentRow][currentCol]) return false;
      currentRow += rowStep;
      currentCol += colStep;
    }

    return true;
  }

  function makeMove(fromRow, fromCol, toRow, toCol) {
    const piece = board[fromRow][fromCol];
    const capturedPiece = board[toRow][toCol];

    if(capturedPiece) {
      const capturedPieceName = PIECE_NAMES[capturedPiece.type];
      if(capturedPiece.color === 'white') {
        capturedWhite.push(PIECES[capturedPiece.color][capturedPieceName]);
      } else {
        capturedBlack.push(PIECES[capturedPiece.color][capturedPieceName]);
      }
      updateCapturedPieces();
      playSound(800, 0.2);
    }

    board[toRow][toCol] = piece;
    board[fromRow][fromCol] = null;
    piece.hasMoved = true;

    if(piece.type === 'pawn' && (toRow === 0 || toRow === 7)) {
      piece.type = 'queen';
      playSound(1000, 0.3);
    }

    currentPlayer = currentPlayer === 'white' ? 'black' : 'white';
    renderBoard();
    updateStatus();
    playSound(600, 0.15);
  }

  function showValidMoves(row, col) {
    for(let r = 0; r < 8; r++) {
      for(let c = 0; c < 8; c++) {
        if(isValidMove(row, col, r, c)) {
          highlightSquare(r, c, 'valid-move');
        }
      }
    }
  }

  function highlightSquare(row, col, className) {
    const squares = document.querySelectorAll('.square');
    const index = row * 8 + col;
    squares[index].classList.add(className);
  }

  function clearSelection() {
    selectedSquare = null;
    document.querySelectorAll('.square').forEach(square => {
      square.classList.remove('selected', 'valid-move');
    });
  }

  function updateStatus() {
    const statusElement = document.getElementById('status');
    if(gameOver) {
      statusElement.textContent = 'game over';
    } else {
      statusElement.textContent = `${currentPlayer}'s turn`;
    }
  }

  function updateCapturedPieces() {
    const whiteContainer = document.getElementById('capturedWhite');
    const blackContainer = document.getElementById('capturedBlack');

    whiteContainer.innerHTML = '';
    blackContainer.innerHTML = '';

    capturedWhite.forEach(pieceSymbol => {
      const img = document.createElement('img');
      img.src = pieceSymbol;
      img.alt = 'captured';
      whiteContainer.appendChild(img);
    });

    capturedBlack.forEach(pieceSymbol => {
      const img = document.createElement('img');
      img.src = pieceSymbol;
      img.alt = 'captured';
      blackContainer.appendChild(img);
    });
  }

  function resetGame() {
    board = Array(8).fill(null).map(() => Array(8).fill(null));
    currentPlayer = 'white';
    selectedSquare = null;
    gameOver = false;
    capturedWhite = [];
    capturedBlack = [];
    initBoard();
    updateCapturedPieces();
    playSound(500, 0.2);
  }

  function toggleSound() {
    soundEnabled = !soundEnabled;
    const btn = document.getElementById('soundBtn');
    btn.textContent = `sound: ${soundEnabled ? 'on' : 'off'}`;
    if(soundEnabled) playSound(600, 0.1);
  }

  // Initialize game
  initAudio();
  initBoard();
</script>

<!-- /b/ style comment section -->
<div class="container" style="margin-top: 20px;">
  <div style="background: #d6daf0; border: 1px solid #b7c5d9; padding: 8px 12px; margin-bottom: 12px; font-weight: bold;">
    Comments (8)
  </div>

  <!-- Comment 1 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/06/26(Mon)14:45:12</span>
      <span style="color: #800000;">No.690001</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      <span style="color: #789922;">&gt;broken ass chess</span><br>
      <span style="color: #789922;">&gt;pieces literally won't move half the time</span><br>
      <span style="color: #789922;">&gt;mfw this is what peak performance looks like</span><br>
      <br>
      the bar was on the floor and somehow OP still tripped over it
    </div>
  </div>

  <!-- Comment 2 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/06/26(Mon)14:52:33</span>
      <span style="color: #800000;">No.690002</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      <span style="color: #789922;">&gt;&gt;690001</span><br>
      trips confirm<br>
      <br>
      the audio alone makes me want to uninstall my browser
    </div>
  </div>

  <!-- Comment 3 - Sage -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/06/26(Mon)15:03:47</span>
      <span style="color: #800000;">No.690003</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      sage<br>
      <br>
      <span style="color: #789922;">&gt;no AI</span><br>
      <span style="color: #789922;">&gt;pieces don't even work right</span><br>
      <span style="color: #789922;">&gt;calling this a "game"</span><br>
      <br>
      this is literally unplayable garbage. go back to /wsr/
    </div>
  </div>

  <!-- Comment 4 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/06/26(Mon)15:18:22</span>
      <span style="color: #800000;">No.690004</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      <span style="color: #789922;">&gt;&gt;690003</span><br>
      <span style="color: #789922;">&gt;not appreciating the aesthetic</span><br>
      <span style="color: #789922;">&gt;not understanding it's intentionally broken</span><br>
      <br>
      newfag detected. it's SUPPOSED to be brainrot you absolute muppet
    </div>
  </div>

  <!-- Comment 5 - Greentext story -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/06/26(Mon)15:33:11</span>
      <span style="color: #800000;">No.690005</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      <span style="color: #789922;">&gt;be me</span><br>
      <span style="color: #789922;">&gt;try to play chess with friend</span><br>
      <span style="color: #789922;">&gt;bishop refuses to move diagonally</span><br>
      <span style="color: #789922;">&gt;just sits there judging me</span><br>
      <span style="color: #789922;">&gt;knight teleports to random square</span><br>
      <span style="color: #789922;">&gt;pawn promotes itself to queen mid-game</span><br>
      <span style="color: #789922;">&gt;friend ragequits</span><br>
      <span style="color: #789922;">&gt;mfw i won by doing nothing</span><br>
      <br>
      10/10 would get gaslit by chess pieces again
    </div>
  </div>

  <!-- Comment 6 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/06/26(Mon)16:07:44</span>
      <span style="color: #800000;">No.690006</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      why does the rook sound like a fax machine having a stroke
    </div>
  </div>

  <!-- Comment 7 - Dubs -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/06/26(Mon)16:22:22</span>
      <span style="color: #800000;">No.690007</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      <span style="color: #789922;">&gt;&gt;690006</span><br>
      kek'd<br>
      <br>
      check my dubs and OP has to add castling
    </div>
  </div>

  <!-- Comment 8 -->
  <div style="background: #f0e0d6; border: 1px solid #d9bfb7; padding: 8px; margin-bottom: 8px;">
    <div style="font-size: 11px; color: #800000;">
      <span style="color: #117743; font-weight: bold;">Anonymous</span>
      <span style="color: #800000;">01/06/26(Mon)17:15:03</span>
      <span style="color: #800000;">No.690008</span>
    </div>
    <div style="margin-top: 6px; line-height: 1.4;">
      <span style="color: #789922;">&gt;&gt;690007</span><br>
      CHECKED<br>
      <br>
      OP delivers or we riot. also this unironically slaps harder than chess.com<br>
      the audio alone is worth it
    </div>
  </div>
</div>

</body>
</html>
